<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>ChangesAndEffects Demo</title>
    </head>
    <body>
	<h1 style="display:inline-block;">ChangesAndEffects Demo</h1>
	<a href="hhhh">hhhh</a> hsreenivasan@paypal.com
	<div style="width:1500px;">
		<div id="changesAndEffectsLarge" style="display:inline-block;">
		</div>
		<div id="changesAndEffectsSmall" style="display:inline-block;">
		</div>
		<div style="display:inline-block;width:1000px;text-align:center;">
			Large
		</div>
		<div style="display:inline-block;width:400px;text-align:center;">
			Small
		</div>
		<br>
		<small><small>Timezone is PT unless otherwise specified</small></small>
		<br>
		<br>
		<button style="padding:10px;font-weight:bold;margin-left:auto;width:1400px;font-size:1.2em;" type="button" id="refresh">Click to simulate data refresh, using randomized data!</button> 
		<p style="color:maroon;font-weight:bold;">These graphs are interactive! Move your mouse around for tooltips. Click on the change ticket circle to go to the ticket page on service now.</p> 
	</div>
        <script type="text/javascript" src="../d3/d3.min.js"></script>
        <script type="text/javascript" src="../moment/moment.min.js"></script>
        <script type="text/javascript" src="../moment/moment-timezone-with-data.min.js"></script>
        <script type="text/javascript" src="./ChangesAndEffects.js"></script>
        <script type="text/javascript">
		var cae_large = new ChangesAndEffects({
			container_selector: "#changesAndEffectsLarge",
			height: 500,
			width: 1000,
			change_url_formatter: function(ticket_id){
				return "https://www.servicenow.com/" + ticket_id;
			},
			series_keys: ["ModuleA", "ModuleB", "ModuleC", "ModuleD"],
		});
		var cae_small = new ChangesAndEffects({
			container_selector: "#changesAndEffectsSmall",
			height: 300,
			width: 400,
			change_url_formatter: function(ticket_id){
				return "https://www.servicenow.com/" + ticket_id;
			},
			series_keys: ["ModuleA", "ModuleB", "ModuleC", "ModuleD"],
		});
	
		
		var dataset = [
			{ "time":1533081600, "severity": {"worst":"0", "details":{}}, "counts": {ModuleA: 0, ModuleB: 0, ModuleC: 0, ModuleD: 0}, "changes":["CHG1234", "CHG2345"] },
			{ "time":1533082500, "severity": {"worst":"1", "details":{"1":["Comp1", "Comp2"]}}, "counts": {ModuleA: 0, ModuleB: 3, ModuleC: 1, ModuleD: 8 }, "changes":[] },
			{ "time":1533083400, "severity": {"worst":"2", "details":{"1":["Comp1"], "2":["Comp2"]}}, "counts": {ModuleA: 1, ModuleB: 3, ModuleC: 1, ModuleD: 3}, "changes":[] },
			{ "time":1533084300, "severity": {"worst":"3", "details":{"1":["Comp1"], "2":["Comp2", "Comp8"], "3":["Comp15"]}}, "counts": {ModuleA: 2, ModuleB: 1, ModuleC: 5, ModuleD: 7}, "changes":[] },
			{ "time":1533085200, "severity": {"worst":"1", "details":{"1":["Comp1", "Comp2"]}}, "counts": {ModuleA: 0, ModuleB: 2, ModuleC: 5, ModuleD: 8}, "changes":["CHG3456", "CHG4567", "CHG7890"] },
			{ "time":1533086100, "severity": {"worst":"1", "details":{"1":["Comp1", "Comp2"]}}, "counts": {ModuleA: 4, ModuleB: 1, ModuleC: 6, ModuleD: 5}, "changes":["CHG1234"] },
			{ "time":1533087000, "severity": {"worst":"1", "details":{"1":["Comp1", "Comp2"]}}, "counts": {ModuleA: 1, ModuleB: 6, ModuleC: 1, ModuleD: 4}, "changes":["CHG1234"] },
			{ "time":1533087900, "severity": {"worst":"0", "details":{}}, "counts": {ModuleA: 0, ModuleB: 0, ModuleC: 0, ModuleD: 0}, "changes":["CHG1234"] },
			{ "time":1533088800, "severity": {"worst":"0", "details":{}}, "counts": {ModuleA: 0, ModuleB: 0, ModuleC: 0, ModuleD: 0}, "changes":["CHG1234", "CHG2345"] },
			{ "time":1533089700, "severity": {"worst":"1", "details":{"1":["Comp1", "Comp2"]}}, "counts": {ModuleA: 0, ModuleB: 2, ModuleC: 3, ModuleD: 4}, "changes":["CHG1234", "CHG2345"] },
			{ "time":1533090600, "severity": {"worst":"2", "details":{"1":["Comp1"], "2":["Comp2"]}}, "counts": {ModuleA: 0, ModuleB: 5, ModuleC: 1, ModuleD: 4}, "changes":["CHG1234"] },
			{ "time":1533091500, "severity": {"worst":"1", "details":{"1":["Comp1", "Comp2"]}}, "counts": {ModuleA: 0, ModuleB: 2, ModuleC: 5, ModuleD: 7}, "changes":["CHG1234", "CHG2345"] },
			{ "time":1533092400, "severity": {"worst":"0", "details":{}}, "counts": {ModuleA: 0, ModuleB: 0, ModuleC: 0, ModuleD: 0}, "changes":[] },
			{ "time":1533093300, "severity": {"worst":"0", "details":{}}, "counts": {ModuleA: 0, ModuleB: 0, ModuleC: 0, ModuleD: 0}, "changes":[] },
			{ "time":1533094200, "severity": {"worst":"0", "details":{}}, "counts": {ModuleA: 0, ModuleB: 0, ModuleC: 0, ModuleD: 0}, "changes":[] },
			{ "time":1533095100, "severity": {"worst":"0", "details":{}}, "counts": {ModuleA: 0, ModuleB: 0, ModuleC: 0, ModuleD: 0}, "changes":["CHG9999"] },
			{ "time":1533096000, "severity": {"worst":"3", "details":{"1":["Comp1"], "2":["Comp2", "Comp8"], "3":["Comp15"]}}, "counts": {ModuleA: 0, ModuleB: 1, ModuleC: 7, ModuleD: 2}, "changes":["CHG1234", "CHG8787"] },
			{ "time":1533096900, "severity": {"worst":"2", "details":{"1":["Comp1"], "2":["Comp2"]}}, "counts": {ModuleA: 0, ModuleB: 1, ModuleC: 8, ModuleD: 2}, "changes":[] },
			{ "time":1533097800, "severity": {"worst":"1", "details":{"1":["Comp1", "Comp2"]}}, "counts": {ModuleA: 0, ModuleB: 1, ModuleC: 5, ModuleD: 1}, "changes":["CHG1234"] },
			{ "time":1533098700, "severity": {"worst":"0", "details":{}}, "counts": {ModuleA: 0, ModuleB: 0, ModuleC: 0, ModuleD: 0}, "changes":[] },
		]
		cae_large.render(dataset);
		cae_small.render(dataset);
	
		function getRandomInt(max) {
			return Math.floor(Math.random() * Math.floor(max));
		}

		document.getElementById("refresh").addEventListener("click", function(event){
			if(getRandomInt(100) < 30){
				var last_data = dataset[dataset.length-1];
				switch(getRandomInt(4)){
					case 1:
						last_data.counts.ModuleA += 2; break;
					case 2:
						last_data.counts.ModuleB += 2; break;
					case 3:
						last_data.counts.ModuleC += 2; break;
					case 4:
						last_data.counts.ModuleD += 2; break;
					default:
						break;
				}
				if(getRandomInt(2) == 1){
					last_data.changes.push("CHG" + getRandomInt(9999));
				}
			}else{
				dataset.shift();
				var worst = getRandomInt(4).toString();
				var counts = {ModuleA: 0, ModuleB: 0, ModuleC: 0, ModuleD: 0};
				if(worst != "0"){
					counts = {ModuleA: getRandomInt(5), ModuleB: getRandomInt(5), ModuleC: getRandomInt(5), ModuleD: getRandomInt(5)}
				}
				var new_item = {
						"time":(dataset[dataset.length-1].time + 15*60),
						"severity": {"worst":worst, "details":{}},
						"counts": counts,
						"changes":[]
						};
				switch(new_item.severity.worst){
					case "1":	
						new_item.severity.details = {"1":["Comp1", "Comp2"]};
						break;
					case "2":	
						new_item.severity.details = {"1":["Comp1"], "2":["Comp2"]};
						break;
					case "3":	
						new_item.severity.details = {"1":["Comp1"], "2":["Comp2", "Comp8"], "3":["Comp15"]};
						break;
					default:
						new_item.severity.details = {}
						break;
				};
				for(var i=0; i<getRandomInt(5); i++){
					new_item.changes.push("CHG" + getRandomInt(9999));
				}
				//console.log(new_item);
				dataset.push(new_item);
			}

			cae_large.render(dataset);
			cae_small.render(dataset);
		});
        </script>
    </body>
</html>
